2218-12-3
星期一：
1.列一份关于版本的文档
2.将星期五所说的将标准格式数据转换为客户数据的回调函数

3.通道管理-->通道商家-->删除
如何解决：view-->payapi-->payapishangjia.html中，将修改方法PayapiShangjiaDel改为DelPayapiShangjia

4.通道分类->添加，删除
解决：1.view-->payapi->payapiclass里添加方法PayapiClassAdd改为AddPayapiClass
2.Payapi控制器里添加AddPayapiClass()方法
3.view-->payapi->payapiclass里删除方法PayapiClassDel改为DelPayapiClass

星期二：
1.通道账号-->解决系统后台轮询权重的修改问题  原因：修改方法后面参数有错误，将后面两个参数删除
<button class="layui-btn" onclick="javascript: FormSumit('<{:U("PayapiaccountloopsEdit")}>','#form1','false');">确认修改</button>
2.整理一份关于交易流程文档


星期三:
系统设置：

星期四：
1.

星期五：
1.
2.


问题：
通道列表中搜索-->状态有问题
解决：由于表中状态值与页面上的值不一致，改变页面的状态值就可以了 

2018-12-10  -----2018-12-14
星期一：
1.权限这块有点问题，今天完成权限流程图，并用思维导图呈现
2.在Pay模块里，在已经写好的通道判断上进行思考，看有没有问题，
如果没有问题，则完善限制域名的判断，完善支付通道状态

昨天留下的问题：通道状态是指表payapi中的status值吗
待解决问题：如何判断类中存在指定的属性,判断域名是否在现有的域名数组中
pay控制器中是否也要加上通道控制器的默认属性，进行判断？


星期二：
1.与汪桂芳一起思考如何获取通道账号，（账号轮询，账号限额），写一个大概的流程代码

问题:如何通过ip查询地域信息


星期三：
1.完善账号轮询，生成订单，处理回调
问题：
一：关于系统订单号
1.系统订单号的长度是否需要在具体通道里设置
2.系统订单号的最短长度和最大长度的限制
3.是否需要判断是否存在系统订单号长度这个属性

二：关于生产订单
1.在生成订单的时候加事务
2.写日志
日志表设计：
id     sys_order_num          user_id     content_log        at_time
        系统订单号                 用户id     日志内容              时间
3.订单表里加ip 
密钥是加密钥表中的还是通道账号中的？？？
商户订单号
系统订单号
用户id
订单金额
异步回调地址
同步回调地址
通道分类编码

返回格式数据的字段在配置文件里有要求 conf/formatdata.php

5.提交地址？？



星期四：
1.修改订单状态（改变金额等），给用户返回信息

解决bug：
一：邀请码
1.改变不同状态的颜色便于区分
2.列表改为以id倒序排列
3.数据库邀请码表的过期时间的类型改为datetime
4.在WPS数据库文档中添加邀请码表



星期五：
1.测试交易流程，完善整个交易过程


2018-12-17  ---  2018-12-21

周一：
1.禁止菜单文件直接在浏览器上访问： 在json文件同级下加上.htaccess文件，直接从根目录复制即可

2.如何获取真实的域名，及端口 ：还有待完善 ，可以利用tp知道的获取ip方式

3.修改生成订单号的方法，给个默认值及长度限制：在生成订单号的方法中，如果没有写订单号，则给一个默认值，如果写了，则判断长度是否在6--32位之间

4.交易流程：选择账号时给每一步加上错误返回信息;每一步加上日志  （日志还没加上）
解决：在AccountController里加一个$error_msg属性，在每一步错误里写入错误信息，然后在最后输出时调用$this->error_msg;即可

5.订单成功后将金额信息等存入ordermoney表，并将用户传的参数都存入一个新的表中，单独建一个存用户参数的表，与系统订单号关联：用户参数以json格式存储
问题：金额方案中到账比例的和一定要为1吗？或者说在账号中，点击方案时，如果方案的到账比例不为1，则拦截

6.生成通道所需要的参数时也要将用户信息传过去

7.在pay模块中写一个封装回调地址的方法，在具体通道中传方法名的参数直接调用得到地址 ：没有完成

8.交易流程中优化if语句，少用else

9.余额方案中，添加立即到账类型只有一种的判断：已经完成
在设置金额方案时，判断一下到账比例是否为1，否则拦截，其次，在选择账号后，判断到账比例是否为1


周二：
1.系统后台登录 ：尝试登陆时，将错误信息记录（用户信息，ip,用户名，密码），达到次数后，限制掉（条件）还加手机验证：等下做
2.在通道账号的密钥设置中都可以上传文件 ：基本做完，后期再完善
3.在日志表中加上一个备注字段，将用户返回信息存入
4.修改账号轮询判断
5.做修改金额方法

周三：
二维码模板页面：汪桂芳在做了
1.完善修改金额方案
2.测试交易流程，并走通
3.通道管理--->代付通道页面 ：基本页面只是在之前的基础上完善，但是具体的流程还得按照交易通道的来


周四：
1.数据统计模块
2.版权管理模块


周五：
1.工单管理
2.消息管理

2018-12-24  === 2018-12-28
1.管理员密码从配置文件中读取，不从数据库中读取 ：不用id=1读取，而是用limit方法读取一条数据，
2.获取系统设置数据时不用id获取，想办法用其他的唯一的东西获取
已解决

2.密钥设置的上传文件需要修改：修改了样式


3.余额设置改成到账设置，余额名称在当前方案中不能重复
4.方案设置只设置冻结的部分，立即到账的部分不用设置，直接算出剩余的部分就是立即到账
6.余额方案做成列表，里面的具体内容做成弹窗
有一个bug：在到账比例中，选择19%，29%。。。时，会出现四舍五入的情况


5.会员编辑-通道设置-账号设置，可单独给它设置到账方案：已解决


7.会员编辑-通道设置加个返回：已解决
9.用户绑定域名时删除有bug，要检查一下 ：没有bug，倒序排列

10.通道中设置的账号取消时，决定一下用户关联的账号也直接取消还是不让通道的账号勾选：
解决：当取消通道账号时，给一个提示（不过后期还得好好考虑考虑怎么好）
一用户账号关联的有：
账号限额  单独设置用户账号的费率，到账方案

如果删除了通道账号，那么关联的用户账号数据都得删除，比较麻烦，所有当有用户账号存在于通道账号时，让通道账号不能取消，

解决通道账号状态问题：
一：当开启账号是：直接往tongdaozhanghao表中增加一条数据
二：当关闭账号时：得考虑该账号是否正在被使用
方案：
1. 利用当前账号id在userpayapiaccount表中查询该账号有没有被使用，如果有，则拦截提示暂不能删除
如果没有，则代表该账号没有被使用，则直接删除tongdaozhanghao表中的数据
2. 如果有，则拦截提示暂不能删除，并且可以查看这个账号被哪一个用户的哪一个通道所使用，而且也可以在里面删除用户对该账号的数据，只有当没有任何用户使用该账号时，该账号才可以删除掉
3. 开启关闭时，给一个提示框
问题有：
1. 如果操作失败，由于是开关类型，虽然数据库的数据没有被改变，但是页面上开关的value值被改变，
不刷新的话，会造成本来一个账号由开启改为关闭，下次再点击时，就说开启了
2. 查看账号被哪一个用户的哪一个使用的列表页面没做分页
3. 可以在表格中。给状态加一个问好提示的标志，上次汪桂芳写过
4. 如果设置了默认账户，将默认账户放在最前面


先获取用户账号，如果没有，再去获取通道账号的默认账号


11.通道的账号设置改成列表，可批量勾选
12.交易流程中，用户没有绑定任何域名时直接不判断 ：以改
13.会员列表绑定域名时倒叙显示，域名判断时完整判断，不能只判断一部分：在用户绑定域名时，给域名加限制条件，在交易中，直接去比对请求域名是否存在于域名组中

批量删除有一个bug：就是没有选择东西时，会报error，就是没有走ajax

先前做的到账设置这块，分页有问题：已解决2018-12-26
在用户中读取账号时，有问题
删除通道账号的时候，该账号对应的账号轮询数据没有删除，导致再次生成账号时，内部报错（Duplicate entry '17' for key 'payapiaccountid'）：代表数据表中 字段payapiaccounti中 已经有17主键的这个数据：已解决

搭建用户后台

账号：设置最小最大金额的方法可以再优化：还有待考虑
只有设置用户账号费率，才会在用户费率表中添加数据
设置用户账号费率时，账号名称写错，与数据库字段名称不一致：已改

需要改的内容：
1. 账号：只设置交易成本费率和结算成本费率  （payapiaccount表，所有字段保留）
2. 通道分类：设置总交易费率和交易最低手续费（payapiaclass表，添加两个字段）
3. 结算设置：设置总结算费率和结算最低手续费（settleconfig表，添加两个字段，修改user_id=0的数据）
4. 代付通道：设置每个通道的结算费率和结算最低手续费  （daifu表，添加两个字段）
5. 用户通道设置：设置通道的交易费率和交易最低手续费  （userpayapiaclass表，添加两个字段）
6. 用户结算设置：选择代付通道，并设置结算费率和结算最低手续费 （settleconfig表，添加两个字段，修改user_id=此用户的数据）


2019-1-2 ---- 2019-1-4
星期三：
1. 配合UI做系统，会员后台登录，会员注册
系统后台登录功能：
会员注册功能：
会员登录功能：

星期四：
1. 有些功能：比如商家，分类，账号，通道在删除时只是单纯的删除了一条记录，修改为软删除
2. 由于改了费率设置的位置，那么在删除用户账号时候，也需要修改对应的删除方法
添加通道分类的时候，需要将分类全部分给商家，还是只分给没有删除的商家？？

bug：
1. 到账设置：如果到账设置方案被使用，则不能直接删除
账号的到账方案
用户账号的到账方案
当删除某一数据时，看看该数据是否被其他数据使用，否则要提示正在使用，暂时不能删除

星期五：
1. 配合汪桂芳会员后台的数据统计模块
2. 有时间研究会员的收款管理模块
















